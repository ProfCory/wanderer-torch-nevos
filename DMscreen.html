<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nevos DM Screen</title>
    <!-- Chosen Palette: Ancient Scroll (Warm neutrals like amber and stone, with red/teal accents for a classic, readable feel) -->
    <!-- Application Structure Plan: A tabbed SPA designed as a DM's digital screen. Main tabs separate 'Dashboard', 'House Rules', 'DM Tools', 'World Lore', and specific 'Campaigns'. This architecture allows quick access to custom mechanics and standard rules while keeping session-specific info (NPCs, plot points, PC sheets) uncluttered. -->
    <!-- Visualization & Content Choices:
        - Report Info: PC Stats -> Goal: Quick character lookup -> Viz: Radar/Bar/Doughnut Charts (via Chart.js) -> Interaction: Hover for details -> Justification: Provides a fast visual "fingerprint" of each PC's build, strengths, and skills, integrated directly into campaign tabs.
        - Report Info: Custom Rules -> Goal: Reference game mechanics -> Presentation: Styled text blocks and tables -> Interaction: None, clarity is key -> Justification: Clearly formatted rules are essential for quick lookups during play.
        - Timeline/Pantheon/Gazetteer: Unchanged, continue to use interactive cards, timelines, and charts for lore exploration.
        - Library/Method: Vanilla JS for all DOM manipulation and state. Chart.js for all data visualizations.
        -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'EB Garamond', serif; }
        h1, h2, h3, h4, h5, h6, .font-sans { font-family: 'Inter', sans-serif; }
        .nav-button { transition: all 0.3s ease; }
        .nav-button.active { background-color: #a855f7; color: white; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .timeline-item::before { content: ''; position: absolute; width: 1rem; height: 1rem; border-radius: 9999px; background-color: #a855f7; left: -0.5rem; top: 50%; transform: translateY(-50%); border: 2px solid #f3f4f6; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .sub-nav-button.active { background-color: #e9d5ff; color: #581c87; font-weight: 600; }
        .pc-nav-button.active { background-color: #c4b5fd; color: #4c1d95; }
        .pc-nav-button[data-campaign="scarredStand"].active { background-color: #fecaca; color: #991b1b; }
        .pc-nav-button[data-campaign="twilightThought"].active { background-color: #ccfbf1; color: #115e59; }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 id="home-button" class="text-4xl md:text-5xl font-bold text-purple-700 tracking-wider cursor-pointer hover:text-purple-900 transition-colors">The Nevos Dossier</h1>
            <p class="text-stone-600 mt-2 text-lg">An Interactive Reference for the World of Nevos</p>
        </header>

        <nav class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8">
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100 active" data-target="home">Dashboard</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="house-rules">House Rules</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="dm-tools">DM Tools</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="world">World Lore</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="scarred-stand">Scarred Stand</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="twilight-thought">Twilight Thought</button>
        </nav>

        <main id="content-container">
            <!-- Sections will be populated by JavaScript -->
            <section id="home" class="content-section space-y-8"></section>
            <section id="house-rules" class="content-section hidden space-y-8"></section>
            <section id="dm-tools" class="content-section hidden space-y-8"></section>
            <section id="world" class="content-section hidden space-y-12"></section>
            <section id="scarred-stand" class="content-section hidden space-y-8"></section>
            <section id="twilight-thought" class="content-section hidden space-y-8"></section>
        </main>
    </div>

    <!-- Modal Structure -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50"><div id="modal-content" class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 relative"><button id="modal-close" class="absolute top-4 right-4 text-stone-500 hover:text-stone-800 font-bold text-2xl">&times;</button></div></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Master data object containing all game and character information.
    const masterData = {
        dmTools: {
            actions: [{ name: 'Attack', content: 'Make one melee or ranged attack.' }, { name: 'Cast a Spell', content: 'Cast a spell with a casting time of 1 action.' }, { name: 'Dash', content: 'Gain extra movement for the current turn.' }, { name: 'Disengage', content: 'Your movement doesn’t provoke opportunity attacks.' }, { name: 'Dodge', content: 'Attack rolls against you have disadvantage if you can see the attacker.' }, { name: 'Help', content: 'Give an ally advantage on an ability check or an attack.' }, { name: 'Hide', content: 'Make a Dexterity (Stealth) check to become unseen.' }, { name: 'Ready', content: 'Set a trigger and take your action as a reaction.' }, { name: 'Search', content: 'Devote your attention to finding something.' }, { name: 'Use an Object', content: 'Interact with a second object on your turn.' }],
            conditions: [{ name: "Blinded", content: "Can't see, fail sight-based checks. Attacks against have advantage, your attacks have disadvantage." }, { name: "Charmed", content: "Can't attack the charmer. Charmer has advantage on social checks against you." }, { name: "Deafened", content: "Can't hear, fail hearing-based checks." }, { name: "Frightened", content: "Disadvantage on attacks/checks while source of fear is visible. Can't move closer to it." }, { name: "Grappled", content: "Speed is 0." }, { name: "Incapacitated", content: "Can't take actions or reactions." }, { name: "Invisible", content: "Heavily obscured for hiding. Attacks against have disadvantage, your attacks have advantage." }, { name: "Paralyzed", content: "Incapacitated, can't move/speak. Auto-fail STR/DEX saves. Attacks against have advantage & are critical hits if within 5ft." }, { name: "Petrified", content: "Transformed to stone, weight x10. Incapacitated, unaware. Resistance to all damage." }, { name: "Poisoned", content: "Disadvantage on attack rolls and ability checks." }, { name: "Prone", content: "Can only crawl. Disadvantage on attacks. Attacks against have advantage if within 5ft, else disadvantage." }, { name: "Restrained", content: "Speed is 0. Attacks against have advantage, your attacks have disadvantage. Disadvantage on DEX saves." }, { name: "Stunned", content: "Incapacitated, can't move, speak falteringly. Auto-fail STR/DEX saves. Attacks against have advantage." }, { name: "Unconscious", content: "Incapacitated, unaware, prone. Auto-fail STR/DEX saves. Attacks against have advantage & are critical hits if within 5ft." }]
        },
        world: {
            calendar: [{m:"Valkeryn",s:"Verdance"},{m:"Meredahl",s:"Verdance"},{m:"Aelos",s:"Scorchrest"},{m:"Kaelor",s:"Scorchrest"},{m:"Solmera",s:"Gildharrow"},{m:"Elyth",s:"Gildharrow"},{m:"Vesht",s:"Siltwane"},{m:"Threnys",s:"Siltwane"},{m:"Dravath",s:"Ashreap"},{m:"Yureth",s:"Ashreap"},{m:"Inarith",s:"Drifthollow"},{m:"Evarain",s:"Drifthollow"},{m:"Karnoss",s:"Frostwrath"}],
            seasons: [{n:"Verdance",d:"Spring thaw, soft rains."}, {n:"Scorchrest",d:"Intense sun, drought."}, {n:"Gildharrow",d:"Prosperous harvest."}, {n:"Siltwane",d:"Devastating floods."}, {n:"Ashreap",d:"Grim second harvest."}, {n:"Drifthollow",d:"Pervasive mist, decay."}, {n:"Frostwrath",d:"Brutal winter, famine."}],
            pantheon: [{n:"Solivane",t:"The Torch Sovereign",d:"Freedom, Light",s:"☀️"},{n:"Valkeryn",t:"The Exultant",d:"War",s:"⚔️"},{n:"Meredahl",t:"The Nurturing",d:"Life",s:"🌿"},{n:"Aelos",t:"The Patient",d:"Knowledge",s:"📖"},{n:"Kaelor",t:"The Inspirational",d:"Light, Fire",s:"🔥"},{n:"Solmera",t:"The Joyful",d:"Luck, Travel",s:"✨"},{n:"Elyth",t:"The Still and Deep",d:"Nature, Grave",s:"🌳"},{n:"Vesht",t:"The Wily",d:"Trickery",s:"🎭"},{n:"Threnys",t:"The Silent Shepherd",d:"Benevolent Death",s:"🌙"},{n:"Dravath",t:"The Resolute",d:"Tempest, Order",s:"🔨"},{n:"Yureth",t:"The Mysterious",d:"Knowledge, Twilight",s:"🌀"},{n:"Inarith",t:"The Sacred Maker",d:"Arcana, Forge",s:"⚙️"},{n:"Karnoss",t:"The Inevitable",d:"Malevolent Death",s:"💀"},{n:"Evarain",t:"The Exile",d:"Fate, Shadow",s:"⛓️"}],
            regions: {Valerost:{c:"Redmarch Keep",p:"Humans, orcs",cu:"Martial traditions",t:"Crimson hills",n:{Meredorn:5,Solvenar:9}},Meredorn:{c:"Lindelwen",p:"Halflings, humans",cu:"Life-blessing rites",t:"River valleys",n:{Valerost:5,Aelorthal:6}},Aelorthal:{c:"Vault of Names",p:"Elves, gnomes",cu:"Oath-scribes",t:"Steppe-highlands",n:{Meredorn:6,Kaelmar:7}},Kaelmar:{c:"Ashspire",p:"Warforged, dwarves",cu:"Trial pyres",t:"Fire-plateaus",n:{Aelorthal:7,Solvenar:5}},Solvenar:{c:"Caravanrest",p:"Humans, halflings",cu:"Traveling shrines",t:"Salt roads",n:{Kaelmar:5,Valerost:9,Elyndor:5}},Elyndor:{c:"Gravemire",p:"Elves, druids",cu:"Ritewalks",t:"Birch forests",n:{Solvenar:5,Veshtarun:5}},Veshtarun:{c:"Maskmere",p:"Gnomes, tieflings",cu:"Disguise rites",t:"Mist-wrapped deltas",n:{Elyndor:5,Threnvalen:3}},Threnvalen:{c:"Lanterndeep",p:"Elves, humans",cu:"Mourning processions",t:"Marsh woods",n:{Veshtarun:3,Dravaskor:4}},Dravaskor:{c:"Oathvault",p:"Dwarves, orcs",cu:"Thunder-vows",t:"Thunder cliffs",n:{Threnvalen:4,Yurevanth:5}},Yurevanth:{c:"Veilspire",p:"Elves, oracles",cu:"Sleep rites",t:"Fog canyons",n:{Dravaskor:5,Inarune:4}},Inarune:{c:"Emberlock",p:"Warforged, dwarves",cu:"Tinkering guilds",t:"Iron valleys",n:{Yurevanth:4,Evarayne:4}},Evarayne:{c:"Fateshroud",p:"Tieflings, wanderers",cu:"Prophecy rites",t:"Ridge-shadowed hills",n:{Inarune:4,Karnathul:5}},Karnathul:{c:"Finalhold",p:"Refugees, survivors",cu:"End-year rituals",t:"Ice-swept plains",n:{Evarayne:5}}},
            peoples: [{n:"Humans & Orcs",c:"Societies are a source of tension. Human societies are patriarchal; Orcish societies are matriarchal."},{n:"Dwarves",c:"Society is built on hearth-bound oaths and ancient family lines, not kings."},{n:"Elves",c:"Governed by counsel of elders who value silence, time, and memory."},{n:"Warforged & Dragonborn",c:"An ancient feud defines their relationship from the Celestial War (~850 years ago)."},{n:"Halflings & Gnomes",c:"Favor direct democracy or local consensus."},{n:"Star-Touched",c:"Aasimar and Tieflings. Their births are seen as omens."}],
            history: [{e:"~150y Ago",t:"Age of Fracture",v:"The Sundering of Pacthall, a major economic alliance, collapses."},{e:"~115y Ago",t:"Raid of the Red Moor",v:"Orc-led matriarchs defeat a knightly incursion in Valerost, rising to political power."},{e:"~85y Ago",t:"Discovery of Residuum",v:"A potent magical essence is discovered, triggering a 'gold rush'."},{e:"~60y Ago",t:"Age of Advancement",v:"Inarune begins cautiously reactivating the ancient Warforged."},{e:"~25y Ago",t:"Veilspire Eclipse",v:"A powerful convergence of the moons plunges the world into twilight for a day."}]
        },
        campaigns: {
            scarredStand: { 
                npcs:[{name:"Matriarch Vorga",title:"Patron",content:"Revered orc matriarch. Seeks to reclaim the Stand to cement orcish honor. <b>Secret:</b> The mission is deeply personal."},{name:"Lord-Commander Valerius",title:"Rival Faction",content:"Charismatic human commander. Seeks to reclaim the Stand for waning human influence. <b>Secret:</b> Cleansing his family's name from past betrayals."},{name:"Knight-Captain Dragan",title:"The Rival",content:"Fiercely loyal champion of the opposing hall. Will race the party to the Stand."},{name:"Scribe Elara",title:"The Lore Keeper",content:"A scholar from Aelorthal hired to verify historical markings."},{name:"'Old Scar' Borok",title:"The Guide",content:"Old orc scout bound by oath to guide the party. Weary of conflict."}], 
                opening:[{title:"Scene 1: An Oath in the Keep",content:"The party is summoned by their chosen patron and swears a binding Valerostian oath."},{title:"Scene 2: The Briefing and the Guide",content:"The party meets their support team and learns of the rival expedition."},{title:"Scene 3: A Challenge at the Gates",content:"Dragan confronts the party, invoking an honor duel to prove their worthiness."}],
                pcs: {"shaman":{"name":"Shaman","classLevel":"Druid 4","classes":{"Druid":4},"species":"Mark of Detection Half-Elf","background":"Custom","hp":31,"ac":14,"speed":"30 ft. walk","abilities":{"STR":8,"DEX":10,"CON":14,"INT":14,"WIS":18,"CHA":12},"abilityMods":{"STR":-1,"DEX":0,"CON":2,"INT":2,"WIS":4,"CHA":1},"saves":["CON","WIS"],"senses":{"perception":17,"insight":17,"investigation":15,"darkvision":"60 ft."},"attacks":[{"name":"Primal Savagery","bonus":"+6","damage":"1d10 Acid"},{"name":"Starry Wisp","bonus":"+6","damage":"1d8 Radiant"}],"features":[{"name":"Wild Shape (2/LR)"},{"name":"Circle of the Moon"},{"name":"Deductive Intuition"},{"name":"Skill Expert"}]},"rowan":{"name":"Rowan","classLevel":"Paladin 3","classes":{"Paladin":3},"species":"Warforged","background":"Haunted One","hp":34,"ac":20,"speed":"30 ft. walk","abilities":{"STR":18,"DEX":10,"CON":18,"INT":13,"WIS":16,"CHA":16},"abilityMods":{"STR":4,"DEX":0,"CON":4,"INT":1,"WIS":3,"CHA":3},"saves":["WIS","CHA"],"senses":{"perception":13,"insight":13,"darkvision":"None"},"attacks":[{"name":"Battleaxe","bonus":"+6","damage":"1d8+4 S"},{"name":"Shortbow","bonus":"+2","damage":"1d6 P"}],"features":[{"name":"Lay On Hands (15HP)"},{"name":"Divine Smite"},{"name":"Channel Divinity (2/LR)"},{"name":"Oath of the Ancients"},{"name":"Integrated Protection"}]},"nimwick":{"name":"Nimwick","classLevel":"Wizard 4","classes":{"Wizard":4},"species":"Gnome","background":"Sage","hp":22,"ac":12,"speed":"30 ft. walk","abilities":{"STR":8,"DEX":14,"CON":12,"INT":17,"WIS":18,"CHA":13},"abilityMods":{"STR":-1,"DEX":2,"CON":1,"INT":3,"WIS":4,"CHA":1},"saves":["INT","WIS","CHA"],"senses":{"perception":16,"insight":14,"darkvision":"60 ft."},"attacks":[{"name":"Shocking Grasp","bonus":"+5","damage":"1d8 L"},{"name":"Fire Bolt","bonus":"+6","damage":"1d10 F"}],"features":[{"name":"Arcane Recovery"},{"name":"Arcane Ward (11 HP)"},{"name":"Abjuration Savant"},{"name":"Gnomish Cunning"},{"name":"Sentinel"}]},"gorlag":{"name":"Gorlag","classLevel":"Barbarian 4","classes":{"Barbarian":4},"species":"Orc","background":"Soldier","hp":45,"ac":16,"speed":"30 ft. walk, 30 ft. fly","abilities":{"STR":19,"DEX":16,"CON":17,"INT":7,"WIS":16,"CHA":7},"abilityMods":{"STR":4,"DEX":3,"CON":3,"INT":-2,"WIS":3,"CHA":-2},"saves":["STR","CON"],"senses":{"perception":15,"insight":13,"darkvision":"120 ft."},"attacks":[{"name":"Greataxe","bonus":"+6","damage":"1d12+4 S"},{"name":"Handaxe","bonus":"+6","damage":"1d6+4 S"}],"features":[{"name":"Rage (3/LR)"},{"name":"Unarmored Defense"},{"name":"Danger Sense"},{"name":"Reckless Attack"},{"name":"Path of the World Tree"}]}}
            },
            twilightThought: {
                factions: [{name:"The Lumen Covenant",content:"Radiant, devout scholars of Solivane. <b>Goal:</b> Recover a celestial relic from a 'reborn' isle."}, {name:"The Hollow Trace",content:"Clandestine, dream-inked occultists. <b>Goal:</b> Investigate sealed tunnels tied to the Veilspire Eclipse."}],
                npcs: [{name:"Thalen 'Inkgut' Brost",title:"Pale Orc Fence",content:"Trades in stolen scrolls and 'bottled dreams'. Distrusts both factions. <b>Hook:</b> Carries fragments of warforged plating that 'talk'."}, {name:"Elsin Tarell",title:"Moon Elf Rumor Broker",content:"A 'shadow cartographer' who tracks strange phenomena. <b>Hook:</b> Has obsessively mapped the shadow path of the Veilspire Eclipse."}],
                pcs: {"wade":{"name":"Wade","classLevel":"Rogue 3 / Ranger 1","classes":{"Rogue":3,"Ranger":1},"species":"Hadozee","background":"Guide","hp":28,"ac":19,"speed":"30 ft. walk, 30 ft. climb","abilities":{"STR":9,"DEX":20,"CON":12,"INT":14,"WIS":15,"CHA":13},"abilityMods":{"STR":-1,"DEX":5,"CON":1,"INT":2,"WIS":2,"CHA":1},"saves":["DEX","INT"],"senses":{"perception":16,"insight":12,"darkvision":"None"},"attacks":[{"name":"Longbow","bonus":"+7","damage":"1d8+5 P"},{"name":"Shortbow","bonus":"+7","damage":"1d6+5 P"},{"name":"Shortsword","bonus":"+7","damage":"1d6+5 S"}],"features":[{"name":"Sneak Attack (2d6)"},{"name":"Cunning Action"},{"name":"Steady Aim"},{"name":"Favored Enemy (Hunter's Mark)"},{"name":"Glide"}]},"scarpphire":{"name":"Scarpphire","classLevel":"Barbarian 2 / Fighter 2","classes":{"Barbarian":2,"Fighter":2},"species":"Shifter","background":"Guide","hp":43,"ac":15,"speed":"30 ft. walk, 30 ft. fly","abilities":{"STR":17,"DEX":14,"CON":16,"INT":9,"WIS":14,"CHA":11},"abilityMods":{"STR":3,"DEX":2,"CON":3,"INT":-1,"WIS":2,"CHA":0},"saves":["STR","CON"],"senses":{"perception":14,"insight":12,"darkvision":"60 ft."},"attacks":[{"name":"Silvered Maul","bonus":"+5","damage":"2d6+3 B"},{"name":"Unarmed Strike","bonus":"+5","damage":"1d6+3 B"},{"name":"Fangs (Bonus)","bonus":"+5","damage":"1d6+3 P"}],"features":[{"name":"Rage (2/LR, +2 dmg)"},{"name":"Reckless Attack"},{"name":"Action Surge (1/SR)"},{"name":"Second Wind (2/LR)"},{"name":"Shifting (Longtooth)"}]},"onya":{"name":"Onya Tisslyn","classLevel":"Monk 3 / Ranger 1","classes":{"Monk":3,"Ranger":1},"species":"Air Genasi","background":"Custom","hp":32,"ac":16,"speed":"45 ft. walk","abilities":{"STR":10,"DEX":17,"CON":15,"INT":14,"WIS":17,"CHA":8},"abilityMods":{"STR":0,"DEX":3,"CON":2,"INT":2,"WIS":3,"CHA":-1},"saves":["STR","DEX"],"senses":{"perception":13,"insight":13,"darkvision":"60 ft."},"attacks":[{"name":"Unarmed Strike","bonus":"+5","damage":"1d6+3 B"},{"name":"Flurry of Blows (1 Focus)","bonus":"+5","damage":"2 unarmed"}],"features":[{"name":"Focus (3 pts)"},{"name":"Deflect Attacks"},{"name":"Shadow Arts"},{"name":"Mingle with the Wind"},{"name":"Favored Enemy (Hunter's Mark)"}]},"lyarieth":{"name":"Lyari'eth","classLevel":"Cleric 4","classes":{"Cleric":4},"species":"Astral Elf","background":"Sage","hp":35,"ac":20,"speed":"30 ft. walk","abilities":{"STR":8,"DEX":14,"CON":16,"INT":10,"WIS":20,"CHA":10},"abilityMods":{"STR":-1,"DEX":2,"CON":3,"INT":0,"WIS":5,"CHA":0},"saves":["WIS","CHA"],"senses":{"perception":22,"insight":17,"darkvision":"300 ft."},"attacks":[{"name":"Toll the Dead","bonus":"DC 15","damage":"1d8/1d12 N"},{"name":"Guiding Bolt","bonus":"+7","damage":"4d6 R"},{"name":"Spiritual Weapon","bonus":"+7","damage":"1d8+5 F"}],"features":[{"name":"War Caster"},{"name":"Channel Divinity (2/LR)"},{"name":"Twilight Sanctuary"},{"name":"Eyes of Night (300ft)"},{"name":"Vigilant Blessing"}]},"nihlium":{"name":"Nihlium","classLevel":"Sorcerer 3 / Warlock 1","classes":{"Sorcerer":3,"Warlock":1},"species":"Stygian Shade","background":"Investigator","hp":35,"ac":15,"speed":"30 ft. walk","abilities":{"STR":8,"DEX":14,"CON":18,"INT":16,"WIS":12,"CHA":19},"abilityMods":{"STR":-1,"DEX":2,"CON":4,"INT":3,"WIS":1,"CHA":4},"saves":["CON","CHA"],"senses":{"perception":13,"insight":11,"darkvision":"60 ft."},"attacks":[{"name":"Eldritch Blast","bonus":"+7","damage":"1d10 F"},{"name":"Chromatic Orb","bonus":"+6","damage":"3d8 flexible"}],"features":[{"name":"Metamagic (3 pts)"},{"name":"Favored by the Gods (1/SR)"},{"name":"Ghostly Flesh (1/LR)"},{"name":"Eldritch Mind"},{"name":"Patron: The Great Old One"}]}}
            }
        }
    };

    let activeChartInstances = {};

    // --- Core Functions ---

    /**
     * Switches the main content view to the specified target section.
     * @param {string} targetId - The ID of the section to show.
     */
    function switchTab(targetId) {
        document.querySelectorAll('.content-section').forEach(section => section.classList.add('hidden'));
        const targetSection = document.getElementById(targetId);
        if (targetSection) {
            targetSection.classList.remove('hidden');
        }
        document.querySelectorAll('.nav-button').forEach(button => {
            button.classList.toggle('active', button.dataset.target === targetId);
        });
    }
    
    /**
     * Switches the sub-tab view within a campaign or world lore section.
     * @param {string} context - The key of the parent section (e.g., 'scarredStand').
     * @param {string} targetId - The ID of the sub-pane to show.
     */
    function switchSubTab(context, targetId) {
        document.querySelectorAll(`#${context}-content-container .sub-content-pane`).forEach(pane => pane.classList.add('hidden'));
        const targetPane = document.getElementById(targetId);
        if(targetPane) targetPane.classList.remove('hidden');
        
        document.querySelectorAll(`.sub-nav-button[data-context="${context}"]`).forEach(button => {
            button.classList.toggle('active', button.dataset.target === targetId);
        });
    }

    /**
     * Creates a styled accordion item.
     * @param {object} item - The data for the accordion item.
     * @param {string} [color='purple'] - The theme color for the item.
     * @returns {string} The HTML string for the accordion item.
     */
    function createAccordionItem(item, color = 'purple') {
        const title = item.name || item.title;
        return `<div class="border border-stone-200 rounded-lg overflow-hidden"><button class="accordion-toggle w-full text-left p-4 bg-white hover:bg-stone-50 flex justify-between items-center"><span class="font-sans font-bold text-${color}-700">${title}</span><span class="transform transition-transform duration-300 text-${color}-500">▼</span></button><div class="accordion-content hidden p-4 bg-stone-50 border-t border-stone-200"><p class="prose max-w-none">${item.content}</p></div></div>`;
    }
    
    /**
     * Initializes all accordions within a given container.
     * @param {string} containerId - The ID of the container with accordions.
     */
    function initAccordions(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.querySelectorAll('.accordion-toggle').forEach(button => {
            if (button.dataset.listenerAttached) return;
            button.dataset.listenerAttached = true;
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const icon = button.querySelector('span:last-child');
                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            });
        });
    }
    
    /**
     * Builds the HTML for a single player character sheet.
     * @param {string} campaignKey - The key for the campaign in masterData (e.g., 'scarredStand').
     * @param {string} charId - The ID of the character.
     * @param {string} themeColor - The color theme for the sheet ('red' or 'teal').
     * @returns {string} The HTML string for the character sheet.
     */
    function buildCharacterHTML(campaignKey, charId, themeColor) {
         const data = masterData.campaigns[campaignKey].pcs[charId];
         if (!data) return ''; // Safeguard against missing character data
         const abilityScoresHTML = Object.entries(data.abilities).map(([k,v])=>`<div class="text-center bg-stone-50 rounded-lg p-2 shadow-inner"><div class="font-bold text-sm">${k}</div><div class="text-2xl font-light">${v}</div><div class="text-${themeColor}-600 font-semibold">${data.abilityMods[k]>=0?'+':''}${data.abilityMods[k]}</div></div>`).join('');
         const attacksHTML = (data.attacks || []).map(a=>`<tr class="border-b border-stone-200 last:border-b-0"><td class="py-2 pr-2"><div class="font-semibold">${a.name}</div><div class="text-xs text-stone-500">${a.damage}</div></td><td class="py-2 px-2 text-center font-mono">${a.bonus}</td></tr>`).join('');
         const featuresHTML = (data.features || []).map(f=>`<div class="py-2"><h4 class="font-semibold text-sm">${f.name}</h4><p class="text-xs text-stone-600">${f.desc || ''}</p></div>`).join('');
         return `<div id="${campaignKey}-${charId}-content" class="pc-pane space-y-8 hidden"><div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><div class="lg:col-span-1 space-y-8"><div class="bg-white rounded-xl shadow-lg p-4"><h2 class="text-3xl font-bold text-${themeColor}-800">${data.name}</h2><p class="text-md text-stone-500">${data.species} ${data.classLevel}</p><div class="mt-4 grid grid-cols-3 gap-4"><div class="text-center bg-stone-100 p-3 rounded-lg"><div class="text-2xl font-light">${data.hp}</div><div class="text-sm font-semibold">HP</div></div><div class="text-center bg-stone-100 p-3 rounded-lg"><div class="text-2xl font-light">${data.ac}</div><div class="text-sm font-semibold">AC</div></div><div class="text-center bg-stone-100 p-3 rounded-lg"><div class="text-2xl font-light">${data.speed.split(' ')[0]}</div><div class="text-sm font-semibold">Speed</div></div></div><div class="mt-4 text-center text-sm text-stone-500">PP: <span class="font-bold text-stone-700">${data.senses.perception}</span> &bull; PI: <span class="font-bold text-stone-700">${data.senses.insight}</span> &bull; Darkvision: <span class="font-bold text-stone-700">${data.senses.darkvision}</span></div></div><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Abilities</h3><div class="grid grid-cols-3 gap-2 mb-4">${abilityScoresHTML}</div><div class="chart-container h-48"><canvas id="${campaignKey}-${charId}-ability-chart"></canvas></div></div><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Class Levels</h3><div class="chart-container h-48"><canvas id="${campaignKey}-${charId}-class-chart"></canvas></div></div></div><div class="lg:col-span-2 space-y-8"><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Combat</h3><table class="w-full text-sm"><thead><tr class="bg-stone-200"><th class="px-3 py-2 text-left rounded-l-lg">Attack</th><th class="px-3 py-2 text-center rounded-r-lg">Bonus</th></tr></thead><tbody>${attacksHTML}</tbody></table></div><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Key Features</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-x-4">${featuresHTML}</div></div></div></div></div>`;
    }

    /**
     * Creates the radar chart for a character's ability scores.
     * @param {string} campaignKey - The campaign's key in masterData.
     * @param {string} charId - The character's ID.
     */
    function createAbilityChart(campaignKey, charId) {
        const canvasId=`${campaignKey}-${charId}-ability-chart`;const ctx=document.getElementById(canvasId);if(!ctx)return;if(activeChartInstances[canvasId])activeChartInstances[canvasId].destroy();
        const themeColor = campaignKey === 'scarredStand' ? 'red' : 'teal';
        const chartColors = {'red': { bg: 'rgba(220, 38, 38, 0.2)', border: 'rgb(185, 28, 28)' },'teal': { bg: 'rgba(13, 148, 136, 0.2)', border: 'rgb(13, 148, 136)'}};
        activeChartInstances[canvasId]=new Chart(ctx,{type:'radar',data:{labels:Object.keys(masterData.campaigns[campaignKey].pcs[charId].abilities),datasets:[{label:'Scores',data:Object.values(masterData.campaigns[campaignKey].pcs[charId].abilities),fill:true,backgroundColor:chartColors[themeColor].bg,borderColor:chartColors[themeColor].border,pointBackgroundColor:chartColors[themeColor].border}]},options:{maintainAspectRatio:false,scales:{r:{angleLines:{color:'rgba(100,116,139,0.2)'},grid:{color:'rgba(100,116,139,0.2)'},pointLabels:{font:{size:10}},suggestedMin:0,suggestedMax:20,ticks:{display:false}}},plugins:{legend:{display:false}}}});
    }

    /**
     * Creates the doughnut chart for a character's class levels.
     * @param {string} campaignKey - The campaign's key in masterData.
     * @param {string} charId - The character's ID.
     */
    function createClassChart(campaignKey, charId) {
        const canvasId=`${campaignKey}-${charId}-class-chart`;const ctx=document.getElementById(canvasId);if(!ctx)return;if(activeChartInstances[canvasId])activeChartInstances[canvasId].destroy();const data=masterData.campaigns[campaignKey].pcs[charId].classes;const names=Object.keys(data);if(names.length<=1){const parentEl = ctx.parentElement; if(parentEl) parentEl.classList.add('hidden');return;} else {const parentEl = ctx.parentElement; if(parentEl) parentEl.classList.remove('hidden');}
        const themeColors = {'red': { bg: ['rgba(239, 68, 68, 0.7)', 'rgba(124, 58, 237, 0.7)'], border: ['rgb(220, 38, 38)', 'rgb(109, 40, 217)'] },'teal': { bg: ['rgba(13, 148, 136, 0.7)', 'rgba(124, 58, 237, 0.7)'], border: ['rgb(15, 118, 110)', 'rgb(109, 40, 217)'] }};
        const colors = themeColors[campaignKey === 'scarredStand' ? 'red' : 'teal'];
        activeChartInstances[canvasId]=new Chart(ctx,{type:'doughnut',data:{labels:names,datasets:[{data:Object.values(data),backgroundColor:colors.bg,borderColor:colors.border}]},options:{maintainAspectRatio:false,plugins:{legend:{position:'top'}}}});
    }

    /**
     * Initializes the player character sheets section for a campaign.
     * @param {string} campaignKey - The campaign's key in masterData.
     * @param {string} themeColor - The color theme ('red' or 'teal').
     */
    function initPCSheets(campaignKey, themeColor) {
        const pcData = masterData.campaigns[campaignKey].pcs;
        const navContainer = document.getElementById(`${campaignKey}-character-nav`);
        const contentContainer = document.getElementById(`${campaignKey}-character-content`);
        if (!navContainer || !contentContainer || !pcData || Object.keys(pcData).length === 0) return;
        
        Object.keys(pcData).forEach(charId => {
            const char = pcData[charId];
            const button = document.createElement('button');
            button.className = `pc-nav-button font-sans px-3 py-1 rounded-md text-sm bg-${themeColor}-100 text-${themeColor}-800 hover:bg-${themeColor}-200`;
            button.textContent = char.name;
            button.dataset.char = charId;
            button.dataset.campaign = campaignKey;
            button.addEventListener('click', () => showCharacter(campaignKey, charId));
            navContainer.appendChild(button);
            contentContainer.innerHTML += buildCharacterHTML(campaignKey, charId, themeColor);
        });
        showCharacter(campaignKey, Object.keys(pcData)[0]);
    }

    /**
     * Displays a specific character sheet within a campaign tab.
     * @param {string} campaignKey - The campaign's key in masterData.
     * @param {string} charId - The character's ID.
     */
    function showCharacter(campaignKey, charId) {
        document.querySelectorAll(`#${campaignKey}-character-content .pc-pane`).forEach(p => p.classList.add('hidden'));
        const targetPane = document.getElementById(`${campaignKey}-${charId}-content`);
        if (targetPane) targetPane.classList.remove('hidden');
        document.querySelectorAll(`#${campaignKey}-character-nav .pc-nav-button`).forEach(b => {
            b.classList.toggle('active', b.dataset.char === charId);
        });
        createAbilityChart(campaignKey, charId); 
        createClassChart(campaignKey, charId);
    }

    // --- Main Rendering and Initialization ---

    /**
     * Renders all dynamic content sections and attaches event listeners.
     */
    function initialize() {
        // --- Render Static Content ---
        document.getElementById('home').innerHTML = `<div><h2 class="text-3xl font-bold text-purple-600 mb-4 border-b-2 border-purple-200 pb-2">Welcome, Dungeon Master</h2><p class="text-lg leading-relaxed">This interactive dossier is your guide to the world of Nevos. Use the navigation above to access house rules, DM tools, world lore, or dive into campaign specifics.</p></div><div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Campaign Quick-Links</h3><div class="space-y-4"><div><h4 class="font-sans font-bold text-xl text-red-700">Reclaiming the Scarred Stand</h4><p class="mt-1 text-stone-600"><strong>Status:</strong> Allied with Matriarch Vorga. Party is taking the cavern route with Old Scar.</p><button class="nav-button-link font-sans mt-2 text-purple-600 hover:underline" data-target="scarred-stand">Go to Campaign →</button></div><div class="border-t border-stone-200 pt-4"><h4 class="font-sans font-bold text-xl text-teal-700">Twilight Thought</h4><p class="mt-1 text-stone-600"><strong>Status:</strong> Sided with the Hollow Trace. The party acquired a map and proceeds alone into the caves/crypt.</p><button class="nav-button-link font-sans mt-2 text-purple-600 hover:underline" data-target="twilight-thought">Go to Campaign →</button></div></div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">The Daily Cycle of the Torch</h3><p class="mb-4">The Torch moon waxes and wanes over a 24-hour period, dividing the day into eight distinct phases.</p><ol class="list-decimal list-inside space-y-2 text-stone-700"><li><span class="font-bold">Rest-time</span> (~12a-3a)</li> <li><span class="font-bold">Wake-time</span> (~3a-6a)</li><li><span class="font-bold">Begin-time</span> (~6a-9a)</li> <li><span class="font-bold">Bustle-time</span> (~9a-12p)</li><li><span class="font-bold">Feast-time</span> (~12p-3p)</li> <li><span class="font-bold">Finale-time</span> (~3p-6p)</li><li><span class="font-bold">Supine-time</span> (~6p-9p)</li> <li><span class="font-bold">Dim-time</span> (~9p-12a)</li></ol></div></div>`;
        document.getElementById('house-rules').innerHTML = `<h2 class="text-3xl font-bold text-purple-600 mb-4 border-b-2 border-purple-200 pb-2">House Rules & Variants</h2><div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Action Economy & Criticals</h3><div class="prose max-w-none"><h4>Potion Usage</h4><ul><li><strong>Action:</strong> Max effect.</li><li><strong>Bonus Action:</strong> Rolled effect.</li><li><strong>Giving:</strong> Requires free interaction from both.</li></ul><h4>Critical Successes (Nat 20)</h4><p>Maximize damage dice + add one additional roll.</p><h4>Critical Failures (Nat 1)</h4><p>No auto-fail. May trigger situational "misfires."</p></div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">NPC Attitude System</h3><div class="prose max-w-none"><p>NPC attitudes (Friendly, Indifferent, Hostile) shift based on player actions and social rolls.</p><table class="w-full text-left"><thead><tr class="border-b"><th class="p-2">Attitude</th><th class="p-2">Behavior</th><th class="p-2">How to Change</th></tr></thead><tbody><tr class="border-b"><td class="p-2">💚 Friendly</td><td class="p-2">Helpful</td><td class="p-2">Maintain goodwill.</td></tr><tr class="border-b"><td class="p-2">😐 Indifferent</td><td class="p-2">Needs incentive</td><td class="p-2">Persuade, bribe.</td></tr><tr><td class="p-2">👿 Hostile</td><td class="p-2">Opposes</td><td class="p-2">Diplomacy, intimidate.</td></tr></tbody></table></div></div></div><div class="bg-white p-6 rounded-xl shadow-lg mt-8"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Coordinated Assault (Flanking Variant)</h3><div class="prose max-w-none"><p>Gain a bonus to melee attack rolls equal to the number of non-incapacitated allies within the target's reach (max +5).</p><h4>Exceptions</h4><ul><li>Does not apply against creatures with exceptional awareness (e.g., Beholders), the Alert feat, or if the target is Tiny.</li></ul></div></div>`;
        document.getElementById('dm-tools').innerHTML = `<h2 class="text-3xl font-bold text-purple-600 mb-4 border-b-2 border-purple-200 pb-2">DM's Toolkit (5e Rules)</h2><div class="grid md:grid-cols-2 gap-8"><div class="space-y-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Actions in Combat</h3><div id="combat-actions-accordion" class="space-y-2">${masterData.dmTools.actions.map(item => createAccordionItem(item)).join('')}</div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Conditions</h3><div id="conditions-accordion" class="space-y-2">${masterData.dmTools.conditions.map(item => createAccordionItem(item)).join('')}</div></div></div><div class="space-y-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Environment</h3><div class="space-y-4"><div><h4 class="font-sans font-bold">Cover</h4><ul class="list-disc list-inside"><li><strong>Half:</strong> +2 AC/DEX saves.</li><li><strong>3/4:</strong> +5 AC/DEX saves.</li><li><strong>Total:</strong> Cannot be targeted directly.</li></ul></div><div><h4 class="font-sans font-bold">Light</h4><ul class="list-disc list-inside"><li><strong>Bright:</strong> Normal vision.</li><li><strong>Dim:</strong> Lightly obscured.</li><li><strong>Darkness:</strong> Heavily obscured (blinded).</li></ul></div></div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Travel Pace</h3><table class="w-full text-left text-sm"><thead><tr class="border-b"><th class="p-2">Pace</th><th class="p-2">Hour</th><th class="p-2">Day</th><th class="p-2">Effect</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Fast</td><td class="p-2">4 mi</td><td class="p-2">30 mi</td><td class="p-2">-5 Perception</td></tr><tr class="border-b"><td class="p-2">Normal</td><td class="p-2">3 mi</td><td class="p-2">24 mi</td><td class="p-2">—</td></tr><tr><td class="p-2">Slow</td><td class="p-2">2 mi</td><td class="p-2">18 mi</td><td class="p-2">Can use stealth</td></tr></tbody></table></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Typical DCs</h3><table class="w-full text-left"><thead><tr class="border-b"><th class="p-2">Difficulty</th><th class="p-2">DC</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Very Easy</td><td class="p-2">5</td></tr><tr class="border-b"><td class="p-2">Easy</td><td class="p-2">10</td></tr><tr class="border-b"><td class="p-2">Medium</td><td class="p-2">15</td></tr><tr class="border-b"><td class="p-2">Hard</td><td class="p-2">20</td></tr><tr class="border-b"><td class="p-2">Very Hard</td><td class="p-2">25</td></tr><tr><td class="p-2">Nearly Impossible</td><td class="p-2">30</td></tr></tbody></table></div></div></div>`;
        
        // --- Render Dynamic Content and Attach Listeners ---
        const ssCampaignKey = 'scarredStand';
        const ttCampaignKey = 'twilightThought';
        
        // Render Scarred Stand Campaign
        document.getElementById('scarred-stand').innerHTML = `<header class="text-center p-6 bg-red-800 text-white rounded-xl shadow-lg"><h2 class="text-4xl font-bold">Reclaiming the Scarred Stand</h2><p class="mt-2 text-red-100 text-lg">A campaign of politics, honor, and ambition in Valerost.</p></header><div class="p-4 bg-white rounded-xl shadow-md mt-8"><div class="flex flex-wrap justify-center gap-2 md:gap-4"><button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-red-100 text-red-800 hover:bg-red-200 active" data-context="${ssCampaignKey}" data-target="${ssCampaignKey}-info">Intel</button><button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-red-100 text-red-800 hover:bg-red-200" data-context="${ssCampaignKey}" data-target="${ssCampaignKey}-pcs">Player Characters</button></div></div><div id="${ssCampaignKey}-content-container" class="mt-8"><div id="${ssCampaignKey}-info" class="sub-content-pane space-y-8"><div class="grid md:grid-cols-2 gap-8"><div class="space-y-8 bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-red-800 mb-4">Dramatis Personae</h3><div id="scarred-stand-npcs" class="space-y-4">${masterData.campaigns.scarredStand.npcs.map(item => createAccordionItem(item, 'red')).join('')}</div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-red-800 mb-4">Opening Act</h3><div id="scarred-stand-opening" class="space-y-4">${masterData.campaigns.scarredStand.opening.map(item => createAccordionItem(item, 'red')).join('')}</div></div></div></div><div id="${ssCampaignKey}-pcs" class="sub-content-pane hidden space-y-4"><nav id="${ssCampaignKey}-character-nav" class="flex flex-wrap justify-center gap-2 mb-6"></nav><div id="${ssCampaignKey}-character-content"></div></div></div>`;
        
        // Render Twilight Thought Campaign
        document.getElementById('twilight-thought').innerHTML = `<header class="text-center p-6 bg-teal-800 text-white rounded-xl shadow-lg"><h2 class="text-4xl font-bold">Twilight Thought</h2><p class="mt-2 text-teal-100 text-lg">A campaign of mystery and cosmic consequence in Veilspire.</p></header><div class="p-4 bg-white rounded-xl shadow-md mt-8"><div class="flex flex-wrap justify-center gap-2 md:gap-4"><button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-teal-100 text-teal-800 hover:bg-teal-200 active" data-context="${ttCampaignKey}" data-target="${ttCampaignKey}-info">Intel</button><button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-teal-100 text-teal-800 hover:bg-teal-200" data-context="${ttCampaignKey}" data-target="${ttCampaignKey}-pcs">Player Characters</button></div></div><div id="${ttCampaignKey}-content-container" class="mt-8"><div id="${ttCampaignKey}-info" class="sub-content-pane space-y-8"><div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-teal-800 mb-4">Factions of Veilspire</h3><div id="twilight-thought-factions" class="space-y-4">${masterData.campaigns.twilightThought.factions.map(item => createAccordionItem(item, 'teal')).join('')}</div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-teal-800 mb-4">Persons of Interest</h3><div id="twilight-thought-npcs" class="space-y-4">${masterData.campaigns.twilightThought.npcs.map(item => createAccordionItem(item, 'teal')).join('')}</div></div></div></div><div id="${ttCampaignKey}-pcs" class="sub-content-pane hidden space-y-4"><nav id="${ttCampaignKey}-character-nav" class="flex flex-wrap justify-center gap-2 mb-6"></nav><div id="${ttCampaignKey}-character-content"></div></div></div>`;

        // Render World Lore
        document.getElementById('world').innerHTML = `<div class="p-4 bg-white rounded-xl shadow-md"><div class="flex flex-wrap justify-center gap-2 md:gap-4"><button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200 active" data-context="world" data-target="world-cosmology">Cosmology</button><button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-pantheon">Pantheon</button><button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-gazetteer">Gazetteer</button><button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-peoples">Peoples</button><button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-history">History</button></div></div><div id="world-content-container" class="mt-8"><div id="world-cosmology" class="sub-content-pane space-y-8"></div><div id="world-pantheon" class="sub-content-pane hidden"></div><div id="world-gazetteer" class="sub-content-pane hidden space-y-8"></div><div id="world-peoples" class="sub-content-pane hidden space-y-8"></div><div id="world-history" class="sub-content-pane hidden"></div></div>`;
        renderWorldSubTabs();

        // --- Attach All Event Listeners ---
        document.querySelectorAll('.nav-button').forEach(button => button.addEventListener('click', (e) => switchTab(e.currentTarget.dataset.target)));
        document.getElementById('home-button').addEventListener('click', () => switchTab('home'));
        document.querySelectorAll('.nav-button-link').forEach(button => button.addEventListener('click', (e) => switchTab(e.currentTarget.dataset.target)));
        document.querySelectorAll('.sub-nav-button').forEach(button => button.addEventListener('click', (e) => switchSubTab(e.currentTarget.dataset.context, e.currentTarget.dataset.target)));
        
        // Initialize dynamic components
        initAccordions('dm-tools');
        initAccordions(`${ssCampaignKey}-content-container`);
        initAccordions(`${ttCampaignKey}-content-container`);
        initPCSheets(ssCampaignKey, 'red');
        initPCSheets(ttCampaignKey, 'teal');
        
        // Set Initial State
        switchTab('home');
        switchSubTab(ssCampaignKey, `${ssCampaignKey}-info`);
        switchSubTab(ttCampaignKey, `${ttCampaignKey}-info`);
        switchSubTab('world', `world-cosmology`);
    }
    
    function renderWorldSubTabs(){
        document.getElementById('world-cosmology').innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Calendar & Seasons</h3><div class="grid md:grid-cols-2 gap-8"><div><h4 class="font-bold text-xl mb-2">The Thirteen Months</h4><ol class="list-decimal list-inside space-y-1">${masterData.world.calendar.map(m => `<li><strong>${m.m}</strong> (${m.s})</li>`).join('')}</ol></div><div><h4 class="font-bold text-xl mb-2">The Seven Seasons</h4><div class="space-y-2">${masterData.world.seasons.map(s => `<div><strong>${s.n}:</strong> ${s.d}</div>`).join('')}</div></div></div></div>`;
        document.getElementById('world-pantheon').innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">The Pantheon of Nevos</h3><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">${masterData.world.pantheon.map(d => `<div class="border border-stone-200 p-4 rounded-lg bg-stone-50"><h4 class="font-bold text-xl text-purple-800">${d.s} ${d.n}</h4><p class="text-stone-600 italic">${d.t}</p><p class="mt-2"><strong>Domains:</strong> ${d.d}</p></div>`).join('')}</div></div>`;
        document.getElementById('world-gazetteer').innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Gazetteer</h3><div id="gazetteer-accordion" class="space-y-2">${Object.entries(masterData.world.regions).map(([name, data]) => `<div class="border border-stone-200 rounded-lg overflow-hidden"><button class="accordion-toggle w-full text-left p-4 bg-white hover:bg-stone-50 flex justify-between items-center"><span class="font-sans font-bold text-purple-700">${name}</span><span class="transform transition-transform duration-300 text-purple-500">▼</span></button><div class="accordion-content hidden p-4 bg-stone-50 border-t border-stone-200"><p><strong>Capital:</strong> ${data.c}</p><p><strong>Peoples:</strong> ${data.p}</p><p><strong>Culture:</strong> ${data.cu}</p><p><strong>Territory:</strong> ${data.t}</p><p><strong>Neighbors:</strong> ${Object.entries(data.n).map(([n_name, n_dist]) => `${n_name} (${n_dist} days)`).join(', ')}</p></div></div>`).join('')}</div></div>`;
        initAccordions('gazetteer-accordion');
        document.getElementById('world-peoples').innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Peoples of Nevos</h3><div class="space-y-4">${masterData.world.peoples.map(p => `<div class="border-l-4 border-purple-300 pl-4"><h4 class="font-bold text-xl">${p.n}</h4><p>${p.c}</p></div>`).join('')}</div></div>`;
        document.getElementById('world-history').innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">A Brief History of Recent Times</h3><div class="relative border-l-2 border-purple-200 pl-8 space-y-8">${masterData.world.history.map(h => `<div class="timeline-item"><h4 class="font-bold text-xl">${h.t} <span class="text-stone-500 text-base font-normal">(${h.e})</span></h4><p>${h.v}</p></div>`).join('')}</div></div>`;
    }

    // --- Start the application ---
    initialize();
});
</script>
</body>
</html>
