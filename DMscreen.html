<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nevos DM Screen</title>
    <!-- Chosen Palette: Ancient Scroll (Warm neutrals like amber and stone, with red/teal accents for a classic, readable feel) -->
    <!-- Application Structure Plan: A tabbed SPA designed as a DM's digital screen. Main tabs separate 'Dashboard', 'House Rules', 'DM Tools', 'World Lore', and specific 'Campaigns'. This architecture allows quick access to custom mechanics and standard rules while keeping session-specific info (NPCs, plot points, PC sheets) uncluttered. -->
    <!-- Visualization & Content Choices:
        - Report Info: PC Stats -> Goal: Quick character lookup -> Viz: Radar/Bar/Doughnut Charts (via Chart.js) -> Interaction: Hover for details -> Justification: Provides a fast visual "fingerprint" of each PC's build, strengths, and skills, integrated directly into campaign tabs.
        - Report Info: Custom Rules -> Goal: Reference game mechanics -> Presentation: Styled text blocks and tables -> Interaction: None, clarity is key -> Justification: Clearly formatted rules are essential for quick lookups during play.
        - Timeline/Pantheon/Gazetteer: Unchanged, continue to use interactive cards, timelines, and charts for lore exploration.
        - Library/Method: Vanilla JS for all DOM manipulation and state. Chart.js for all data visualizations.
        -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'EB Garamond', serif;
        }
        h1, h2, h3, h4, h5, h6, .font-sans {
            font-family: 'Inter', sans-serif;
        }
        .nav-button {
            transition: all 0.3s ease;
        }
        .nav-button.active {
            background-color: #a855f7; /* purple-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            width: 1rem;
            height: 1rem;
            border-radius: 9999px;
            background-color: #a855f7; /* purple-500 */
            left: -0.5rem;
            top: 50%;
            transform: translateY(-50%);
            border: 2px solid #f3f4f6; /* gray-100 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .sub-nav-button.active {
            background-color: #e9d5ff; /* purple-200 */
            color: #581c87; /* purple-900 */
            font-weight: 600;
        }
        .pc-nav-button.active {
             background-color: #c4b5fd;
             color: #4c1d95;
        }
        .pc-nav-button[data-campaign="scarred-stand"].active {
            background-color: #fecaca; /* red-200 */
            color: #991b1b; /* red-800 */
        }
        .pc-nav-button[data-campaign="twilight-thought"].active {
            background-color: #ccfbf1; /* teal-100 */
            color: #115e59; /* teal-800 */
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-purple-700 tracking-wider">The Nevos Dossier</h1>
            <p class="text-stone-600 mt-2 text-lg">An Interactive Reference for the World of Nevos</p>
        </header>

        <nav class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8">
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100 active" data-target="home">Dashboard</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="house-rules">House Rules</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="dm-tools">DM Tools</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="world">World Lore</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="scarred-stand">Scarred Stand</button>
            <button class="nav-button font-sans px-4 py-2 rounded-lg bg-white shadow-sm hover:bg-purple-100" data-target="twilight-thought">Twilight Thought</button>
        </nav>

        <main id="content-container">
            <!-- Dashboard Section -->
            <section id="home" class="content-section space-y-8">
                <div>
                    <h2 class="text-3xl font-bold text-purple-600 mb-4 border-b-2 border-purple-200 pb-2">Welcome, Dungeon Master</h2>
                    <p class="text-lg leading-relaxed">This interactive dossier is your guide to the world of Nevos. Use the navigation above to access house rules, DM tools, world lore, or dive into campaign specifics. Everything you need is at your fingertips.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                     <div class="bg-white p-6 rounded-xl shadow-lg">
                         <h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Campaign Quick-Links</h3>
                         <div class="space-y-4">
                            <div>
                                <h4 class="font-sans font-bold text-xl text-red-700">Reclaiming the Scarred Stand</h4>
                                <p class="mt-1 text-stone-600"><strong>Status:</strong> Allied with Matriarch Vorga. Party is taking the cavern route with Old Scar.</p>
                                <button class="nav-button-link font-sans mt-2 text-purple-600 hover:underline" data-target="scarred-stand">Go to Campaign ‚Üí</button>
                            </div>
                            <div class="border-t border-stone-200 pt-4">
                                <h4 class="font-sans font-bold text-xl text-teal-700">Twilight Thought</h4>
                                <p class="mt-1 text-stone-600"><strong>Status:</strong> Sided with the Hollow Trace. The party acquired a map and proceeds alone into the caves/crypt.</p>
                                <button class="nav-button-link font-sans mt-2 text-purple-600 hover:underline" data-target="twilight-thought">Go to Campaign ‚Üí</button>
                            </div>
                         </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">The Daily Cycle of the Torch</h3>
                        <p class="mb-4">The Torch moon waxes and wanes over a 24-hour period, dividing the day into eight distinct phases.</p>
                        <ol class="list-decimal list-inside space-y-2 text-stone-700">
                            <li><span class="font-bold">Rest-time</span> (~12a-3a)</li> <li><span class="font-bold">Wake-time</span> (~3a-6a)</li>
                            <li><span class="font-bold">Begin-time</span> (~6a-9a)</li> <li><span class="font-bold">Bustle-time</span> (~9a-12p)</li>
                            <li><span class="font-bold">Feast-time</span> (~12p-3p)</li> <li><span class="font-bold">Finale-time</span> (~3p-6p)</li>
                            <li><span class="font-bold">Supine-time</span> (~6p-9p)</li> <li><span class="font-bold">Dim-time</span> (~9p-12a)</li>
                        </ol>
                    </div>
                </div>
            </section>
            
            <!-- House Rules Section -->
            <section id="house-rules" class="content-section hidden space-y-8">
                <h2 class="text-3xl font-bold text-purple-600 mb-4 border-b-2 border-purple-200 pb-2">House Rules & Variants</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Action Economy & Criticals</h3>
                        <div class="prose max-w-none">
                            <h4>Potion Usage</h4>
                            <ul>
                                <li><strong>Action:</strong> Drink a potion to gain its maximum effect.</li>
                                <li><strong>Bonus Action:</strong> Drink a potion for its standard rolled effect.</li>
                                <li><strong>Giving a Potion:</strong> Requires the free object interaction from both the giver and the receiver.</li>
                            </ul>
                            <h4>Critical Successes (Nat 20)</h4>
                            <p>Maximize the damage dice and add one additional roll of the same dice.</p>
                            <h4>Critical Failures (Nat 1)</h4>
                            <p>Standard critical failures are not used. Instead, a natural 1 may trigger specific "misfire" mechanics or consequences determined by the DM based on the situation.</p>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">NPC Attitude System</h3>
                        <div class="prose max-w-none">
                            <p>NPCs are categorized into three attitudes based on their opinion of the player characters. Actions, reputation, and social rolls can shift these attitudes.</p>
                             <table class="w-full text-left">
                                <thead><tr class="border-b"><th class="p-2">Attitude</th><th class="p-2">Behavior</th><th class="p-2">How to Change</th></tr></thead>
                                <tbody>
                                    <tr class="border-b"><td class="p-2">üíö Friendly</td><td class="p-2">Helpful, open to requests</td><td class="p-2">Maintain goodwill, assist them.</td></tr>
                                    <tr class="border-b"><td class="p-2">üòê Indifferent</td><td class="p-2">Neutral, needs incentive</td><td class="p-2">Persuasion, bribery, proving worth.</td></tr>
                                    <tr><td class="p-2">üëø Hostile</td><td class="p-2">Resists or opposes</td><td class="p-2">Diplomacy, intimidation, meaningful actions.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Coordinated Assault (Flanking Variant)</h3>
                    <div class="prose max-w-none">
                        <p>This rule grants attackers a bonus when multiple individuals engage a single opponent in melee, simulating overwhelming their defenses.</p>
                        <h4>Gaining the Bonus</h4>
                        <p>When you make a melee attack against a creature, you gain a bonus to the attack roll equal to the number of your allies who are not incapacitated and are within that creature's reach. The maximum bonus is +5.</p>
                        <p><strong>Example:</strong> If you and two allies are all within an Ogre's reach, any of you making a melee attack against it gain a +3 bonus to the attack roll.</p>
                        <h4>Exceptions to the Bonus</h4>
                        <ul>
                            <li><strong>Creatures with Exceptional Awareness:</strong> The bonus does not apply against creatures that cannot be effectively overwhelmed (e.g., Beholders, creatures with 360-degree vision).</li>
                            <li><strong>Alert Defenders:</strong> The bonus does not apply against a creature with the Alert feat.</li>
                            <li><strong>Target Size Limitation:</strong> The bonus does not apply if the target creature is Tiny.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- DM Tools Section -->
            <section id="dm-tools" class="content-section hidden space-y-8">
                <h2 class="text-3xl font-bold text-purple-600 mb-4 border-b-2 border-purple-200 pb-2">DM's Toolkit (5e Rules)</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-8">
                        <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Actions in Combat</h3><div id="combat-actions-accordion" class="space-y-2"></div></div>
                        <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Conditions</h3><div id="conditions-accordion" class="space-y-2"></div></div>
                    </div>
                    <div class="space-y-8">
                        <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Environment</h3><div class="space-y-4"><div><h4 class="font-sans font-bold">Cover</h4><ul class="list-disc list-inside"><li><strong>Half:</strong> +2 AC/DEX saves.</li><li><strong>Three-quarters:</strong> +5 AC/DEX saves.</li><li><strong>Total:</strong> Cannot be targeted directly.</li></ul></div><div><h4 class="font-sans font-bold">Light</h4><ul class="list-disc list-inside"><li><strong>Bright:</strong> Normal vision.</li><li><strong>Dim:</strong> Lightly obscured (Disadvantage on Perception).</li><li><strong>Darkness:</strong> Heavily obscured (blinded).</li></ul></div></div></div>
                        <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Travel Pace</h3><table class="w-full text-left text-sm"><thead><tr class="border-b"><th class="p-2">Pace</th><th class="p-2">Hour</th><th class="p-2">Day</th><th class="p-2">Effect</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Fast</td><td class="p-2">4 mi</td><td class="p-2">30 mi</td><td class="p-2">-5 Perception</td></tr><tr class="border-b"><td class="p-2">Normal</td><td class="p-2">3 mi</td><td class="p-2">24 mi</td><td class="p-2">‚Äî</td></tr><tr><td class="p-2">Slow</td><td class="p-2">2 mi</td><td class="p-2">18 mi</td><td class="p-2">Can use stealth</td></tr></tbody></table></div>
                        <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-purple-700 mb-4">Typical Difficulty Classes</h3><table class="w-full text-left"><thead><tr class="border-b"><th class="p-2">Difficulty</th><th class="p-2">DC</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Very Easy</td><td class="p-2">5</td></tr><tr class="border-b"><td class="p-2">Easy</td><td class="p-2">10</td></tr><tr class="border-b"><td class="p-2">Medium</td><td class="p-2">15</td></tr><tr class="border-b"><td class="p-2">Hard</td><td class="p-2">20</td></tr><tr class="border-b"><td class="p-2">Very Hard</td><td class="p-2">25</td></tr><tr><td class="p-2">Nearly Impossible</td><td class="p-2">30</td></tr></tbody></table></div>
                    </div>
                </div>
            </section>
            
            <!-- World Lore Section -->
            <section id="world" class="content-section hidden space-y-12">
                <div class="p-4 bg-white rounded-xl shadow-md">
                     <div class="flex flex-wrap justify-center gap-2 md:gap-4">
                        <button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200 active" data-context="world" data-target="world-cosmology">Cosmology</button>
                        <button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-pantheon">Pantheon</button>
                        <button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-gazetteer">Gazetteer</button>
                        <button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-peoples">Peoples</button>
                        <button class="sub-nav-button font-sans px-3 py-1 text-sm md:px-4 md:py-2 rounded-lg bg-purple-100 text-purple-800 hover:bg-purple-200" data-context="world" data-target="world-history">History</button>
                    </div>
                </div>
                <div id="world-content-container">
                    <div id="world-cosmology" class="sub-content-pane space-y-8"></div>
                    <div id="world-pantheon" class="sub-content-pane hidden"></div>
                    <div id="world-gazetteer" class="sub-content-pane hidden space-y-8"></div>
                    <div id="world-peoples" class="sub-content-pane hidden space-y-8"></div>
                    <div id="world-history" class="sub-content-pane hidden"></div>
                </div>
            </section>

            <!-- Scarred Stand Section -->
            <section id="scarred-stand" class="content-section hidden space-y-8">
                <header class="text-center p-6 bg-red-800 text-white rounded-xl shadow-lg"><h2 class="text-4xl font-bold">Reclaiming the Scarred Stand</h2><p class="mt-2 text-red-100 text-lg">A campaign of politics, honor, and ambition in Valerost.</p></header>
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500"><h3 class="font-sans text-xl font-bold text-red-800 mb-2">Campaign Status</h3><p>The party has sided with <strong>Matriarch Vorga</strong> and is proceeding through the cavern route with <strong>Old Scar Borok</strong>.</p></div>
                <div class="p-4 bg-white rounded-xl shadow-md">
                     <div class="flex flex-wrap justify-center gap-2 md:gap-4">
                        <button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-red-100 text-red-800 hover:bg-red-200 active" data-context="scarred-stand" data-target="ss-info">Intel</button>
                        <button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-red-100 text-red-800 hover:bg-red-200" data-context="scarred-stand" data-target="ss-pcs">Player Characters</button>
                    </div>
                </div>
                <div id="scarred-stand-content-container">
                    <div id="ss-info" class="sub-content-pane space-y-8"><div class="grid md:grid-cols-2 gap-8"><div class="space-y-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-red-800 mb-4">Dramatis Personae</h3><div id="scarred-stand-npcs" class="space-y-4"></div></div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-red-800 mb-4">Opening Act</h3><div id="scarred-stand-opening" class="space-y-4"></div></div></div></div>
                    <div id="ss-pcs" class="sub-content-pane hidden space-y-4">
                        <nav id="ss-character-nav" class="flex flex-wrap justify-center gap-2 mb-6"></nav>
                        <div id="ss-character-content"></div>
                    </div>
                </div>
            </section>

            <!-- Twilight Thought Section -->
            <section id="twilight-thought" class="content-section hidden space-y-8">
                 <header class="text-center p-6 bg-teal-800 text-white rounded-xl shadow-lg"><h2 class="text-4xl font-bold">Twilight Thought</h2><p class="mt-2 text-teal-100 text-lg">A campaign of mystery and cosmic consequence in Veilspire.</p></header>
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-teal-500"><h3 class="font-sans text-xl font-bold text-teal-800 mb-2">Campaign Status</h3><p>The party accepted the offer from the <strong>Hollow Trace</strong>. They have a map and are venturing alone into the sealed caves and crypts.</p></div>
                 <div class="p-4 bg-white rounded-xl shadow-md">
                     <div class="flex flex-wrap justify-center gap-2 md:gap-4">
                        <button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-teal-100 text-teal-800 hover:bg-teal-200 active" data-context="twilight-thought" data-target="tt-info">Intel</button>
                        <button class="sub-nav-button font-sans px-4 py-2 rounded-lg bg-teal-100 text-teal-800 hover:bg-teal-200" data-context="twilight-thought" data-target="tt-pcs">Player Characters</button>
                    </div>
                </div>
                <div id="twilight-thought-content-container">
                    <div id="tt-info" class="sub-content-pane space-y-8"><div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-teal-800 mb-4">Factions of Veilspire</h3><div id="twilight-thought-factions" class="space-y-4"></div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="font-sans text-2xl font-bold text-teal-800 mb-4">Persons of Interest</h3><div id="twilight-thought-npcs" class="space-y-4"></div></div></div></div>
                    <div id="tt-pcs" class="sub-content-pane hidden space-y-4">
                        <nav id="tt-character-nav" class="flex flex-wrap justify-center gap-2 mb-6"></nav>
                        <div id="tt-character-content"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Structure -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50"><div id="modal-content" class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 relative"><button id="modal-close" class="absolute top-4 right-4 text-stone-500 hover:text-stone-800 font-bold text-2xl">&times;</button></div></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Data objects will be populated by render functions
    const data = { dmTools:{}, world:{}, campaigns:{} };
    let pcData = {};
    let activeChartInstances = {};

    // Main navigation
    const navButtons = document.querySelectorAll('.nav-button');
    const navButtonLinks = document.querySelectorAll('.nav-button-link');
    const subNavButtons = document.querySelectorAll('.sub-nav-button');
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    const modalClose = document.getElementById('modal-close');

    function switchTab(targetId) {
        document.querySelectorAll('.content-section').forEach(section => section.classList.add('hidden'));
        document.getElementById(targetId).classList.remove('hidden');
        navButtons.forEach(button => button.classList.toggle('active', button.dataset.target === targetId));
    }

    function switchSubTab(context, targetId) {
        document.querySelectorAll(`#${context}-content-container .sub-content-pane`).forEach(pane => pane.classList.add('hidden'));
        const targetPane = document.getElementById(targetId);
        if(targetPane) targetPane.classList.remove('hidden');
        
        document.querySelectorAll(`.sub-nav-button[data-context="${context}"]`).forEach(button => {
            button.classList.toggle('active', button.dataset.target === targetId);
        });
    }

    navButtons.forEach(button => button.addEventListener('click', () => switchTab(button.dataset.target)));
    navButtonLinks.forEach(button => button.addEventListener('click', () => switchTab(button.dataset.target)));
    subNavButtons.forEach(button => button.addEventListener('click', () => switchSubTab(button.dataset.context, button.dataset.target)));
    
    modalClose.addEventListener('click', () => modal.classList.add('hidden'));
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });

    function createAccordionItem(item, color = 'purple') {
        const title = item.name || item.title;
        return `<div class="border border-stone-200 rounded-lg overflow-hidden"><button class="accordion-toggle w-full text-left p-4 bg-white hover:bg-stone-50 flex justify-between items-center"><span class="font-sans font-bold text-${color}-700">${title}</span><span class="transform transition-transform duration-300 text-${color}-500">‚ñº</span></button><div class="accordion-content hidden p-4 bg-stone-50 border-t border-stone-200"><p class="prose max-w-none">${item.content}</p></div></div>`;
    }
    
    function initAccordions(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.querySelectorAll('.accordion-toggle').forEach(button => {
            if (button.dataset.listenerAttached) return;
            button.dataset.listenerAttached = true;
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const icon = button.querySelector('span:last-child');
                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            });
        });
    }

    function setupWorldTabLoading() {
        renderCosmology(); renderPantheon(); renderGazetteer(); renderPeoples(); renderHistory();
        initAccordions('world-content-container');
    }
    
    function renderDmTools() {
        data.dmTools = {
            actions: [{ name: 'Attack', content: 'Make one melee or ranged attack.' }, { name: 'Cast a Spell', content: 'Cast a spell with a casting time of 1 action.' }, { name: 'Dash', content: 'Gain extra movement for the current turn.' }, { name: 'Disengage', content: 'Your movement doesn‚Äôt provoke opportunity attacks.' }, { name: 'Dodge', content: 'Attack rolls against you have disadvantage if you can see the attacker.' }, { name: 'Help', content: 'Give an ally advantage on an ability check or an attack.' }, { name: 'Hide', content: 'Make a Dexterity (Stealth) check to become unseen.' }, { name: 'Ready', content: 'Set a trigger and take your action as a reaction.' }, { name: 'Search', content: 'Devote your attention to finding something.' }, { name: 'Use an Object', content: 'Interact with a second object on your turn.' }],
            conditions: [{ name: "Blinded", content: "Can't see, fail sight-based checks. Attacks against have advantage, your attacks have disadvantage." }, { name: "Charmed", content: "Can't attack the charmer. Charmer has advantage on social checks against you." }, { name: "Deafened", content: "Can't hear, fail hearing-based checks." }, { name: "Frightened", content: "Disadvantage on attacks/checks while source of fear is visible. Can't move closer to it." }, { name: "Grappled", content: "Speed is 0." }, { name: "Incapacitated", content: "Can't take actions or reactions." }, { name: "Invisible", content: "Heavily obscured for hiding. Attacks against have disadvantage, your attacks have advantage." }, { name: "Paralyzed", content: "Incapacitated, can't move/speak. Auto-fail STR/DEX saves. Attacks against have advantage & are critical hits if within 5ft." }, { name: "Petrified", content: "Transformed to stone, weight x10. Incapacitated, unaware. Resistance to all damage." }, { name: "Poisoned", content: "Disadvantage on attack rolls and ability checks." }, { name: "Prone", content: "Can only crawl. Disadvantage on attacks. Attacks against have advantage if within 5ft, else disadvantage." }, { name: "Restrained", content: "Speed is 0. Attacks against have advantage, your attacks have disadvantage. Disadvantage on DEX saves." }, { name: "Stunned", content: "Incapacitated, can't move, speak falteringly. Auto-fail STR/DEX saves. Attacks against have advantage." }, { name: "Unconscious", content: "Incapacitated, unaware, prone. Auto-fail STR/DEX saves. Attacks against have advantage & are critical hits if within 5ft." }]
        };
        document.getElementById('combat-actions-accordion').innerHTML = data.dmTools.actions.map(item => createAccordionItem(item)).join('');
        document.getElementById('conditions-accordion').innerHTML = data.dmTools.conditions.map(item => createAccordionItem(item)).join('');
        initAccordions('dm-tools');
    }

    function renderCosmology() {
        data.world.calendar = [{m:"Valkeryn",s:"Verdance"},{m:"Meredahl",s:"Verdance"},{m:"Aelos",s:"Scorchrest"},{m:"Kaelor",s:"Scorchrest"},{m:"Solmera",s:"Gildharrow"},{m:"Elyth",s:"Gildharrow"},{m:"Vesht",s:"Siltwane"},{m:"Threnys",s:"Siltwane"},{m:"Dravath",s:"Ashreap"},{m:"Yureth",s:"Ashreap"},{m:"Inarith",s:"Drifthollow"},{m:"Evarain",s:"Drifthollow"},{m:"Karnoss",s:"Frostwrath"}];
        data.world.seasons = [{n:"Verdance",d:"Spring thaw, soft rains."}, {n:"Scorchrest",d:"Intense sun, drought."}, {n:"Gildharrow",d:"Prosperous harvest."}, {n:"Siltwane",d:"Devastating floods."}, {n:"Ashreap",d:"Grim second harvest."}, {n:"Drifthollow",d:"Pervasive mist, decay."}, {n:"Frostwrath",d:"Brutal winter, famine."}];
        document.getElementById('world-cosmology').innerHTML = `<h3 class="text-3xl font-bold text-purple-600 border-b-2 border-purple-200 pb-2">Cosmology & Time</h3><p class="text-lg">The rhythm of life in Nevos is dictated by the sky's two moons.</p><div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h4 class="font-sans text-xl font-bold text-purple-700 mb-3">Nevosian Calendar</h4><p class="mb-4">13 months of 28 days each, named for the Zodiacal Stars.</p><div class="grid grid-cols-2 gap-x-4 gap-y-2">${data.world.calendar.map((i,idx)=>`<div class="text-sm"><span class="font-bold">${idx+1}. ${i.m}</span> <span class="text-stone-500">(${i.s})</span></div>`).join('')}</div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h4 class="font-sans text-xl font-bold text-purple-700 mb-3">The Seven Seasons</h4><p class="mb-4">A harsh cycle forging resilient cultures.</p><div class="space-y-2">${data.world.seasons.map(s=>`<div><span class="font-bold">${s.n}:</span> <span class="text-stone-600">${s.d}</span></div>`).join('')}</div></div></div>`;
    }

    function renderPantheon() {
        data.world.pantheon = [{n:"Solivane",t:"The Torch Sovereign",d:"Freedom, Light",s:"‚òÄÔ∏è"},{n:"Valkeryn",t:"The Exultant",d:"War",s:"‚öîÔ∏è"},{n:"Meredahl",t:"The Nurturing",d:"Life",s:"üåø"},{n:"Aelos",t:"The Patient",d:"Knowledge",s:"üìñ"},{n:"Kaelor",t:"The Inspirational",d:"Light, Fire",s:"üî•"},{n:"Solmera",t:"The Joyful",d:"Luck, Travel",s:"‚ú®"},{n:"Elyth",t:"The Still and Deep",d:"Nature, Grave",s:"üå≥"},{n:"Vesht",t:"The Wily",d:"Trickery",s:"üé≠"},{n:"Threnys",t:"The Silent Shepherd",d:"Benevolent Death",s:"üåô"},{n:"Dravath",t:"The Resolute",d:"Tempest, Order",s:"üî®"},{n:"Yureth",t:"The Mysterious",d:"Knowledge, Twilight",s:"üåÄ"},{n:"Inarith",t:"The Sacred Maker",d:"Arcana, Forge",s:"‚öôÔ∏è"},{n:"Karnoss",t:"The Inevitable",d:"Malevolent Death",s:"üíÄ"},{n:"Evarain",t:"The Exile",d:"Fate, Shadow",s:"‚õìÔ∏è"}];
        const container = document.getElementById('world-pantheon');
        container.innerHTML = `<h3 class="text-3xl font-bold text-purple-600 border-b-2 border-purple-200 pb-2">The Zodiacal Pantheon</h3><p class="text-lg mb-6">The gods of Nevos are the stars in the sky. All divine power flows from the central sun, Solivane.</p><div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">${data.world.pantheon.map(g=>`<button class="pantheon-card text-left p-4 bg-white rounded-lg shadow hover:shadow-md hover:-translate-y-1 transition-all duration-300 flex flex-col items-center justify-center text-center" data-god="${g.n}"><div class="text-4xl mb-2">${g.s}</div><h4 class="font-sans font-bold text-purple-800">${g.n}</h4><p class="text-sm text-stone-500">${g.t}</p></button>`).join('')}</div>`;
        container.querySelectorAll('.pantheon-card').forEach(c=>c.addEventListener('click',()=>{const g=data.world.pantheon.find(god=>god.n===c.dataset.god);modalContent.innerHTML=`<button id="modal-close-inner" class="absolute top-4 right-4 text-stone-500 hover:text-stone-800 font-bold text-2xl">&times;</button><div class="text-center mb-4"><div class="text-6xl mb-2">${g.s}</div><h2 class="text-3xl font-bold text-purple-700">${g.n}</h2><p class="text-lg text-stone-500">${g.t}</p></div><div class="text-lg"><strong>Domains:</strong> ${g.d}</div>`;document.getElementById('modal-close-inner').addEventListener('click',()=>modal.classList.add('hidden'));modal.classList.remove('hidden');}));
    }
    
    function renderGazetteer() {
        data.world.regions={Valerost:{c:"Redmarch Keep",p:"Humans, orcs",cu:"Martial traditions",t:"Crimson hills",n:{Meredorn:5,Solvenar:9}},Meredorn:{c:"Lindelwen",p:"Halflings, humans",cu:"Life-blessing rites",t:"River valleys",n:{Valerost:5,Aelorthal:6}},Aelorthal:{c:"Vault of Names",p:"Elves, gnomes",cu:"Oath-scribes",t:"Steppe-highlands",n:{Meredorn:6,Kaelmar:7}},Kaelmar:{c:"Ashspire",p:"Warforged, dwarves",cu:"Trial pyres",t:"Fire-plateaus",n:{Aelorthal:7,Solvenar:5}},Solvenar:{c:"Caravanrest",p:"Humans, halflings",cu:"Traveling shrines",t:"Salt roads",n:{Kaelmar:5,Valerost:9,Elyndor:5}},Elyndor:{c:"Gravemire",p:"Elves, druids",cu:"Ritewalks",t:"Birch forests",n:{Solvenar:5,Veshtarun:5}},Veshtarun:{c:"Maskmere",p:"Gnomes, tieflings",cu:"Disguise rites",t:"Mist-wrapped deltas",n:{Elyndor:5,Threnvalen:3}},Threnvalen:{c:"Lanterndeep",p:"Elves, humans",cu:"Mourning processions",t:"Marsh woods",n:{Veshtarun:3,Dravaskor:4}},Dravaskor:{c:"Oathvault",p:"Dwarves, orcs",cu:"Thunder-vows",t:"Thunder cliffs",n:{Threnvalen:4,Yurevanth:5}},Yurevanth:{c:"Veilspire",p:"Elves, oracles",cu:"Sleep rites",t:"Fog canyons",n:{Dravaskor:5,Inarune:4}},Inarune:{c:"Emberlock",p:"Warforged, dwarves",cu:"Tinkering guilds",t:"Iron valleys",n:{Yurevanth:4,Evarayne:4}},Evarayne:{c:"Fateshroud",p:"Tieflings, wanderers",cu:"Prophecy rites",t:"Ridge-shadowed hills",n:{Inarune:4,Karnathul:5}},Karnathul:{c:"Finalhold",p:"Refugees, survivors",cu:"End-year rituals",t:"Ice-swept plains",n:{Evarayne:5}}};
        const container=document.getElementById('world-gazetteer');container.innerHTML=`<h3 class="text-3xl font-bold text-purple-600 border-b-2 border-purple-200 pb-2">Gazetteer of the Thirteen Regions</h3><p class="text-lg mb-6">Select a region to learn more about its people, terrain, and travel connections.</p><div class="flex flex-wrap justify-center gap-2 mb-6" id="region-selector">${Object.keys(data.world.regions).map(n=>`<button class="region-button font-sans px-3 py-1 rounded-md text-sm bg-purple-50 text-purple-700 hover:bg-purple-100" data-region="${n}">${n}</button>`).join('')}</div><div class="bg-white p-6 rounded-xl shadow-lg grid md:grid-cols-2 gap-8"><div id="region-info" class="prose max-w-none"></div><div class="chart-container"><canvas id="travel-chart"></canvas></div></div>`;
        const info=document.getElementById('region-info'),chartCtx=document.getElementById('travel-chart').getContext('2d');
        function displayRegion(name){const r=data.world.regions[name];info.innerHTML=`<h4 class="font-sans text-2xl font-bold text-purple-700 mb-4">${name}</h4><p><strong>Capital:</strong> ${r.c}</p><p><strong>Peoples:</strong> ${r.p}</p><p><strong>Culture:</strong> ${r.cu}</p><p><strong>Terrain:</strong> ${r.t}</p><h5 class="font-sans font-bold mt-4">Travel Times from ${name}</h5>`;if(activeChartInstances.travel)activeChartInstances.travel.destroy();activeChartInstances.travel=new Chart(chartCtx,{type:'bar',data:{labels:Object.keys(r.n),datasets:[{label:'Days of Travel',data:Object.values(r.n),backgroundColor:'rgba(168, 85, 247, 0.6)'}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});}
        container.querySelectorAll('.region-button').forEach(b=>b.addEventListener('click',()=>displayRegion(b.dataset.region)));displayRegion('Valerost');
    }

    function renderPeoples(){data.world.peoples=[{n:"Humans & Orcs",c:"Societies are a source of tension. Human societies are patriarchal; Orcish societies are matriarchal."},{n:"Dwarves",c:"Society is built on hearth-bound oaths and ancient family lines, not kings."},{n:"Elves",c:"Governed by counsel of elders who value silence, time, and memory."},{n:"Warforged & Dragonborn",c:"An ancient feud defines their relationship from the Celestial War (~850 years ago)."},{n:"Halflings & Gnomes",c:"Favor direct democracy or local consensus."},{n:"Star-Touched",c:"Aasimar and Tieflings. Their births are seen as omens."}];document.getElementById('world-peoples').innerHTML=`<h3 class="text-3xl font-bold text-purple-600 border-b-2 border-purple-200 pb-2">Peoples & Major Factions</h3><div class="space-y-2">${data.world.peoples.map(p=>createAccordionItem({name:p.n, content:p.c})).join('')}</div>`;}
    function renderHistory(){data.world.history=[{e:"~150y Ago",t:"Age of Fracture",v:"The Sundering of Pacthall, a major economic alliance, collapses."},{e:"~115y Ago",t:"Raid of the Red Moor",v:"Orc-led matriarchs defeat a knightly incursion in Valerost, rising to political power."},{e:"~85y Ago",t:"Discovery of Residuum",v:"A potent magical essence is discovered, triggering a 'gold rush'."},{e:"~60y Ago",t:"Age of Advancement",v:"Inarune begins cautiously reactivating the ancient Warforged."},{e:"~25y Ago",t:"Veilspire Eclipse",v:"A powerful convergence of the moons plunges the world into twilight for a day."}];document.getElementById('world-history').innerHTML=`<h3 class="text-3xl font-bold text-purple-600 border-b-2 border-purple-200 pb-2">A Chronicle of Recent History</h3><p class="text-lg mb-8">Key events that have shaped the current state of Nevos.</p><div class="relative border-l-4 border-purple-200 ml-4 pl-8 space-y-12">${data.world.history.map(i=>`<div class="timeline-item relative pb-8"><div class="ml-4"><p class="text-sm text-purple-600 font-semibold">${i.e}</p><h4 class="font-sans font-bold text-xl mb-1">${i.t}</h4><p class="text-stone-600">${i.v}</p></div></div>`).join('')}</div>`;}

    function renderScarredStand() {
        data.campaigns.scarredStand = { npcs:[{n:"Matriarch Vorga",t:"Patron",c:"Revered orc matriarch. Seeks to reclaim the Stand to cement orcish honor. <b>Secret:</b> The mission is deeply personal."},{n:"Lord-Commander Valerius",t:"Rival Faction",c:"Charismatic human commander. Seeks to reclaim the Stand for waning human influence. <b>Secret:</b> Cleansing his family's name from past betrayals."},{n:"Knight-Captain Dragan",t:"The Rival",c:"Fiercely loyal champion of the opposing hall. Will race the party to the Stand."},{n:"Scribe Elara",t:"The Lore Keeper",c:"A scholar from Aelorthal hired to verify historical markings."},{n:"'Old Scar' Borok",t:"The Guide",c:"Old orc scout bound by oath to guide the party. Weary of conflict."}], opening:[{t:"Scene 1: An Oath in the Keep",c:"The party is summoned by their chosen patron and swears a binding Valerostian oath."},{t:"Scene 2: The Briefing and the Guide",c:"The party meets their support team and learns of the rival expedition."},{t:"Scene 3: A Challenge at the Gates",c:"Dragan confronts the party, invoking an honor duel to prove their worthiness."}]};
        document.getElementById('scarred-stand-npcs').innerHTML = data.campaigns.scarredStand.npcs.map(item => createAccordionItem({name: item.n, title: item.t, content: item.c}, 'red')).join('');
        document.getElementById('scarred-stand-opening').innerHTML = data.campaigns.scarredStand.opening.map(item => createAccordionItem(item, 'red')).join('');
        initAccordions('scarred-stand-content-container');
    }
    
    function renderTwilightThought() {
        data.campaigns.twilightThought = {
            factions: [{n:"The Lumen Covenant",c:"Radiant, devout scholars of Solivane. <b>Goal:</b> Recover a celestial relic from a 'reborn' isle."}, {n:"The Hollow Trace",c:"Clandestine, dream-inked occultists. <b>Goal:</b> Investigate sealed tunnels tied to the Veilspire Eclipse."}],
            npcs: [{n:"Thalen 'Inkgut' Brost",t:"Pale Orc Fence",c:"Trades in stolen scrolls and 'bottled dreams'. Distrusts both factions. <b>Hook:</b> Carries fragments of warforged plating that 'talk'."}, {n:"Elsin Tarell",t:"Moon Elf Rumor Broker",c:"A 'shadow cartographer' who tracks strange phenomena. <b>Hook:</b> Has obsessively mapped the shadow path of the Veilspire Eclipse."}]
        };
        document.getElementById('twilight-thought-factions').innerHTML = data.campaigns.twilightThought.factions.map(item => createAccordionItem({name: item.n, content: item.c}, 'teal')).join('');
        document.getElementById('twilight-thought-npcs').innerHTML = data.campaigns.twilightThought.npcs.map(item => createAccordionItem({name: item.n, title:item.t, content: item.c}, 'teal')).join('');
        initAccordions('twilight-thought-content-container');
    }
    
    function initPCSheets(campaignId, themeColor, data) {
        pcData[campaignId] = data;
        const navContainer = document.getElementById(`${campaignId}-character-nav`);
        const contentContainer = document.getElementById(`${campaignId}-character-content`);
        if (!navContainer || !contentContainer) return;
        
        Object.keys(data).forEach(charId => {
            const char = data[charId];
            const button = document.createElement('button');
            button.className = `pc-nav-button font-sans px-3 py-1 rounded-md text-sm bg-${themeColor}-50 text-${themeColor}-800 hover:bg-${themeColor}-100`;
            button.textContent = char.name;
            button.dataset.char = charId;
            button.dataset.campaign = campaignId;
            button.addEventListener('click', () => showCharacter(campaignId, charId));
            navContainer.appendChild(button);
            contentContainer.innerHTML += buildCharacterHTML(campaignId, charId, themeColor);
        });
        showCharacter(campaignId, Object.keys(data)[0]);
    }

    function showCharacter(campaignId, charId) {
        document.querySelectorAll(`#${campaignId}-character-content .pc-pane`).forEach(p => p.classList.add('hidden'));
        document.getElementById(`${charId}-content`).classList.remove('hidden');
        document.querySelectorAll(`#${campaignId}-character-nav .pc-nav-button`).forEach(b => b.classList.toggle('active', b.dataset.char === charId));
        createAbilityChart(campaignId, charId); 
        createClassChart(campaignId, charId);
    }

    function buildCharacterHTML(campaignId, charId, themeColor) {
         const data = pcData[campaignId][charId];
         const abilityScoresHTML = Object.entries(data.abilities).map(([k,v])=>`<div class="text-center bg-stone-50 rounded-lg p-2 shadow-inner"><div class="font-bold text-sm">${k}</div><div class="text-2xl font-light">${v}</div><div class="text-${themeColor}-600 font-semibold">${data.abilityMods[k]>=0?'+':''}${data.abilityMods[k]}</div></div>`).join('');
         const attacksHTML = data.attacks.map(a=>`<tr class="border-b border-stone-200 last:border-b-0"><td class="py-2 pr-2"><div class="font-semibold">${a.name}</div><div class="text-xs text-stone-500">${a.damage}</div></td><td class="py-2 px-2 text-center font-mono">${a.bonus}</td></tr>`).join('');
         const featuresHTML = data.features.map(f=>`<div class="py-2"><h4 class="font-semibold text-sm">${f.name}</h4></div>`).join('');
         return `<div id="${charId}-content" class="pc-pane space-y-8 hidden"><div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><div class="lg:col-span-1 space-y-8"><div class="bg-white rounded-xl shadow-lg p-4"><h2 class="text-3xl font-bold text-${themeColor}-800">${data.name}</h2><p class="text-md text-stone-500">${data.species} ${data.classLevel}</p><div class="mt-4 grid grid-cols-3 gap-4"><div class="text-center bg-stone-100 p-3 rounded-lg"><div class="text-2xl font-light">${data.hp}</div><div class="text-sm font-semibold">HP</div></div><div class="text-center bg-stone-100 p-3 rounded-lg"><div class="text-2xl font-light">${data.ac}</div><div class="text-sm font-semibold">AC</div></div><div class="text-center bg-stone-100 p-3 rounded-lg"><div class="text-2xl font-light">${data.speed.split(' ')[0]}</div><div class="text-sm font-semibold">Speed</div></div></div><div class="mt-4 text-center text-sm text-stone-500">PP: <span class="font-bold text-stone-700">${data.senses.perception}</span> &bull; PI: <span class="font-bold text-stone-700">${data.senses.insight}</span> &bull; Darkvision: <span class="font-bold text-stone-700">${data.senses.darkvision}</span></div></div><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Abilities</h3><div class="grid grid-cols-3 gap-2 mb-4">${abilityScoresHTML}</div><div class="chart-container h-48"><canvas id="${campaignId}-${charId}-ability-chart"></canvas></div></div><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Class Levels</h3><div class="chart-container h-48"><canvas id="${campaignId}-${charId}-class-chart"></canvas></div></div></div><div class="lg:col-span-2 space-y-8"><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Combat</h3><table class="w-full text-sm"><thead><tr class="bg-stone-200"><th class="px-3 py-2 text-left rounded-l-lg">Attack</th><th class="px-3 py-2 text-center rounded-r-lg">Bonus</th></tr></thead><tbody>${attacksHTML}</tbody></table></div><div class="bg-white rounded-xl shadow-lg p-4"><h3 class="text-xl font-bold mb-4">Key Features</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-x-4">${featuresHTML}</div></div></div></div></div>`;
    }

    function createAbilityChart(campaignId, charId) {
        const canvasId=`${campaignId}-${charId}-ability-chart`;const ctx=document.getElementById(canvasId);if(!ctx)return;if(activeChartInstances[canvasId])activeChartInstances[canvasId].destroy();
        const themeColor = campaignId === 'scarred-stand' ? 'red' : 'teal';
        const chartColors = {
            'red': { bg: 'rgba(220, 38, 38, 0.2)', border: 'rgb(185, 28, 28)' },
            'teal': { bg: 'rgba(13, 148, 136, 0.2)', border: 'rgb(13, 148, 136)'}
        };
        activeChartInstances[canvasId]=new Chart(ctx,{type:'radar',data:{labels:Object.keys(pcData[campaignId][charId].abilities),datasets:[{label:'Scores',data:Object.values(pcData[campaignId][charId].abilities),fill:true,backgroundColor:chartColors[themeColor].bg,borderColor:chartColors[themeColor].border,pointBackgroundColor:chartColors[themeColor].border}]},options:{maintainAspectRatio:false,scales:{r:{angleLines:{color:'rgba(100,116,139,0.2)'},grid:{color:'rgba(100,116,139,0.2)'},pointLabels:{font:{size:10}},suggestedMin:0,suggestedMax:20,ticks:{display:false}}},plugins:{legend:{display:false}}}});
    }
    function createClassChart(campaignId, charId) {
        const canvasId=`${campaignId}-${charId}-class-chart`;const ctx=document.getElementById(canvasId);if(!ctx)return;if(activeChartInstances[canvasId])activeChartInstances[canvasId].destroy();const data=pcData[campaignId][charId].classes;const names=Object.keys(data);if(names.length<=1){ctx.parentElement.classList.add('hidden');return;}ctx.parentElement.classList.remove('hidden');
        const themeColors = {
            'red': { bg: ['rgba(239, 68, 68, 0.7)', 'rgba(124, 58, 237, 0.7)'], border: ['rgb(220, 38, 38)', 'rgb(109, 40, 217)'] },
            'teal': { bg: ['rgba(13, 148, 136, 0.7)', 'rgba(124, 58, 237, 0.7)'], border: ['rgb(15, 118, 110)', 'rgb(109, 40, 217)'] }
        };
        const colors = themeColors[campaignId === 'scarred-stand' ? 'red' : 'teal'];
        activeChartInstances[canvasId]=new Chart(ctx,{type:'doughnut',data:{labels:names,datasets:[{data:Object.values(data),backgroundColor:colors.bg,borderColor:colors.border}]},options:{maintainAspectRatio:false,plugins:{legend:{position:'top'}}}});
    }
    
    // Initial renders
    renderDmTools();
    setupWorldTabLoading();
    renderScarredStand();
    renderTwilightThought();
    
    // PC Data integration
    const twilightPCData = {"wade":{name:"Wade",classLevel:"Rogue 3 / Ranger 1",classes:{Rogue:3,Ranger:1},species:"Hadozee",hp:28,ac:19,speed:"30 ft.",abilities:{STR:9,DEX:20,CON:12,INT:14,WIS:15,CHA:13},abilityMods:{STR:-1,DEX:5,CON:1,INT:2,WIS:2,CHA:1},senses:{perception:16,insight:12,darkvision:"None"},attacks:[{n:"Longbow",b:"+7",d:"1d8+5 P"},{n:"Shortbow",b:"+7",d:"1d6+5 P"},{n:"Shortsword",b:"+7",d:"1d6+5 S"}],features:[{n:"Sneak Attack (2d6)"},{n:"Cunning Action"},{n:"Steady Aim"},{n:"Favored Enemy (Hunter's Mark)"},{n:"Glide"}]},"scarpphire":{name:"Scarpphire",classLevel:"Barbarian 2 / Fighter 2",classes:{Barbarian:2,Fighter:2},species:"Shifter",hp:43,ac:15,speed:"30 ft.",abilities:{STR:17,DEX:14,CON:16,INT:9,WIS:14,CHA:11},abilityMods:{STR:3,DEX:2,CON:3,INT:-1,WIS:2,CHA:0},senses:{perception:14,insight:12,darkvision:"60 ft."},attacks:[{n:"Silvered Maul",b:"+5",d:"2d6+3 B"},{n:"Unarmed Strike",b:"+5",d:"1d6+3 B"},{n:"Fangs (Bonus)",b:"+5",d:"1d6+3 P"}],features:[{n:"Rage (2/LR, +2 dmg)"},{n:"Reckless Attack"},{n:"Action Surge (1/SR)"},{n:"Second Wind (2/LR)"},{n:"Shifting (Longtooth)"}]},"onya":{name:"Onya Tisslyn",classLevel:"Monk 3 / Ranger 1",classes:{Monk:3,Ranger:1},species:"Air Genasi",hp:32,ac:16,speed:"45 ft.",abilities:{STR:10,DEX:17,CON:15,INT:14,WIS:17,CHA:8},abilityMods:{STR:0,DEX:3,CON:2,INT:2,WIS:3,CHA:-1},senses:{perception:13,insight:13,darkvision:"60 ft."},attacks:[{n:"Unarmed Strike",b:"+5",d:"1d6+3 B"},{n:"Flurry of Blows (1 Focus)",b:"+5",d:"2 unarmed"}],features:[{n:"Focus (3 pts)"},{n:"Deflect Attacks"},{n:"Shadow Arts"},{n:"Mingle with the Wind"},{n:"Favored Enemy (Hunter's Mark)"}]},"lyarieth":{name:"Lyari'eth",classLevel:"Cleric 4",classes:{Cleric:4},species:"Astral Elf",hp:35,ac:20,speed:"30 ft.",abilities:{STR:8,DEX:14,CON:16,INT:10,WIS:20,CHA:10},abilityMods:{STR:-1,DEX:2,CON:3,INT:0,WIS:5,CHA:0},senses:{perception:22,insight:17,darkvision:"300 ft."},attacks:[{n:"Toll the Dead",b:"DC 15",d:"1d8/1d12 N"},{n:"Guiding Bolt",b:"+7",d:"4d6 R"},{n:"Spiritual Weapon",b:"+7",d:"1d8+5 F"}],features:[{n:"War Caster"},{n:"Channel Divinity (2/LR)"},{n:"Twilight Sanctuary"},{n:"Eyes of Night (300ft)"},{n:"Vigilant Blessing"}]},"nihlium":{name:"Nihlium",classLevel:"Sorcerer 3 / Warlock 1",classes:{Sorcerer:3,Warlock:1},species:"Stygian Shade",hp:35,ac:15,speed:"30 ft.",abilities:{STR:8,DEX:14,CON:18,INT:16,WIS:12,CHA:19},abilityMods:{STR:-1,DEX:2,CON:4,INT:3,WIS:1,CHA:4},senses:{perception:13,insight:11,darkvision:"60 ft."},attacks:[{n:"Eldritch Blast",b:"+7",d:"1d10 F"},{n:"Chromatic Orb",b:"+6",d:"3d8 flexible"}],features:[{n:"Metamagic (3 pts)"},{n:"Favored by the Gods (1/SR)"},{n:"Ghostly Flesh (1/LR)"},{n:"Eldritch Mind"},{n:"Patron: The Great Old One"}]}};
    const scarredStandPCData = {"shaman":{name:"Shaman",classLevel:"Druid 4",classes:{Druid:4},species:"Mark of Detection Half-Elf",hp:31,ac:14,speed:"30 ft.",abilities:{STR:8,DEX:10,CON:14,INT:14,WIS:18,CHA:12},abilityMods:{STR:-1,DEX:0,CON:2,INT:2,WIS:4,CHA:1},senses:{perception:17,insight:17,darkvision:"60 ft."},attacks:[{name:"Primal Savagery",bonus:"+6",damage:"1d10 Acid"},{name:"Starry Wisp",bonus:"+6",damage:"1d8 Radiant"}],features:[{name:"Wild Shape (2/LR)"},{name:"Circle of the Moon"},{name:"Deductive Intuition"},{name:"Skill Expert"}]},"rowan":{name:"Rowan",classLevel:"Paladin 3",classes:{Paladin:3},species:"Warforged",hp:34,ac:20,speed:"30 ft.",abilities:{STR:18,DEX:10,CON:18,INT:13,WIS:16,CHA:16},abilityMods:{STR:4,DEX:0,CON:4,INT:1,WIS:3,CHA:3},senses:{perception:13,insight:13,darkvision:"None"},attacks:[{name:"Battleaxe",bonus:"+6",damage:"1d8+4 S"},{name:"Shortbow",bonus:"+2",damage:"1d6 P"}],features:[{name:"Lay On Hands (15HP)"},{name:"Divine Smite"},{name:"Channel Divinity (2/LR)"},{name:"Oath of the Ancients"},{name:"Integrated Protection"}]},"nimwick":{name:"Nimwick",classLevel:"Wizard 4",classes:{Wizard:4},species:"Gnome",hp:22,ac:12,speed:"30 ft.",abilities:{STR:8,DEX:14,CON:12,INT:17,WIS:18,CHA:13},abilityMods:{STR:-1,DEX:2,CON:1,INT:3,WIS:4,CHA:1},senses:{perception:16,insight:14,darkvision:"60 ft."},attacks:[{name:"Shocking Grasp",bonus:"+5",damage:"1d8 L"},{name:"Fire Bolt",bonus:"+6",damage:"1d10 F"}],features:[{name:"Arcane Recovery"},{name:"Arcane Ward (11 HP)"},{name:"Abjuration Savant"},{name:"Gnomish Cunning"},{name:"Sentinel"}]},"gorlag":{name:"Gorlag",classLevel:"Barbarian 4",classes:{Barbarian:4},species:"Orc",hp:45,ac:16,speed:"30 ft.",abilities:{STR:19,DEX:16,CON:17,INT:7,WIS:16,CHA:7},abilityMods:{STR:4,DEX:3,CON:3,INT:-2,WIS:3,CHA:-2},senses:{perception:15,insight:13,darkvision:"120 ft."},attacks:[{name:"Greataxe",bonus:"+6",damage:"1d12+4 S"},{name:"Handaxe",bonus:"+6",damage:"1d6+4 S"}],features:[{name:"Rage (3/LR)"},{name:"Unarmored Defense"},{name:"Danger Sense"},{name:"Reckless Attack"},{name:"Path of the World Tree"}]}};
    
    initPCSheets('twilight-thought', 'teal', twilightPCData);
    initPCSheets('scarred-stand', 'red', scarredStandPCData);
    
    // Set initial active states
    switchTab('home');
    switchSubTab('world', 'world-cosmology');
    switchSubTab('scarred-stand', 'ss-info');
    switchSubTab('twilight-thought', 'tt-info');
});
</script>
</body>
</html>
